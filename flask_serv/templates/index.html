{% extends 'base.html' %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mt-4">
    <h4>Eventos Recientes</h4>
    <div>
        <div class="btn-group">
            <a href="{{ url_for('exportar_datos', formato='csv', **request.args) }}" class="btn btn-success">
                <i class="fa fa-download"></i> Exportar CSV
            </a>
            <a href="{{ url_for('exportar_datos', formato='json', **request.args) }}" class="btn btn-info">
                <i class="fa fa-download"></i> Exportar JSON
            </a>
        </div>
    </div>
</div>

<table class="table table-bordered table-striped">
    <thead class="table-dark">
        <tr>
            <th>Fecha y Hora</th>
            <th>Servicio</th>
            <th>IP</th>
            <th>Detalle</th>
        </tr>
    </thead>
    <tbody>
        {% for evento in eventos %}
        <tr>
            <td>{{ evento.fecha_hora }}</td>
            <td>{{ evento.tipo }}</td>
            <td>{{ evento.ip }}</td>
            <td>{{ evento.detalle }}</td>
        </tr>
        {% else %}
        <tr>
            <td colspan="4" class="text-center">No hay eventos disponibles.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Controles de paginación -->
{% if pagination and pagination.total_pages > 1 %}
<nav aria-label="Paginación de eventos">
    <ul class="pagination justify-content-center">
        <!-- Botón Anterior -->
        <li class="page-item {% if pagination.page == 1 %}disabled{% endif %}">
            <a class="page-link" 
               href="{{ url_for('index', page=pagination.page-1, per_page=pagination.per_page, 
                      servicio=filtros.servicio, ip=filtros.ip, 
                      fecha_inicio=filtros.fecha_inicio, fecha_fin=filtros.fecha_fin, 
                      keyword=filtros.keyword) }}" 
               aria-label="Anterior">
                <span aria-hidden="true">&laquo;</span>
            </a>
        </li>
        
        <!-- Páginas -->
        {% set start_page = [pagination.page - 2, 1] | max %}
        {% set end_page = [start_page + 4, pagination.total_pages] | min %}
        {% set start_page = [end_page - 4, 1] | max %}
        
        {% for p in range(start_page, end_page + 1) %}
        <li class="page-item {% if p == pagination.page %}active{% endif %}">
            <a class="page-link" 
               href="{{ url_for('index', page=p, per_page=pagination.per_page,
                      servicio=filtros.servicio, ip=filtros.ip, 
                      fecha_inicio=filtros.fecha_inicio, fecha_fin=filtros.fecha_fin, 
                      keyword=filtros.keyword) }}">
                {{ p }}
            </a>
        </li>
        {% endfor %}
        
        <!-- Botón Siguiente -->
        <li class="page-item {% if pagination.page == pagination.total_pages %}disabled{% endif %}">
            <a class="page-link" 
               href="{{ url_for('index', page=pagination.page+1, per_page=pagination.per_page,
                      servicio=filtros.servicio, ip=filtros.ip, 
                      fecha_inicio=filtros.fecha_inicio, fecha_fin=filtros.fecha_fin, 
                      keyword=filtros.keyword) }}" 
               aria-label="Siguiente">
                <span aria-hidden="true">&raquo;</span>
            </a>
        </li>
    </ul>
</nav>

<div class="text-center mt-2">
    <p class="text-muted">
        Mostrando {{ eventos | length }} de {{ pagination.total }} eventos 
        (Página {{ pagination.page }} de {{ pagination.total_pages }})
    </p>
</div>
{% endif %}
{% endblock %}